<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Custom Design Wheel Center Cap Preview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Montserrat font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f4f6;
      color: #111827;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page {
      background: #ffffff;
      border-radius: 24px;
      box-shadow:
        0 24px 60px rgba(15, 23, 42, 0.18),
        0 0 0 1px rgba(148, 163, 184, 0.12);
      max-width: 1200px;
      width: 100%;
      padding: 32px 40px;
      display: grid;
      grid-template-columns: minmax(0, 470px) minmax(0, 1fr);
      gap: 32px;
    }

    @media (max-width: 960px) {
      .page {
        grid-template-columns: minmax(0, 1fr);
        padding: 20px 16px 28px;
        border-radius: 0;
        box-shadow: none;
      }
    }

    .canvas-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .canvas-inner {
      width: 470px;
      max-width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #e5e7eb, #d1d5db);
      box-shadow:
        0 35px 70px rgba(15, 23, 42, 0.35),
        0 0 0 16px #f9fafb;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    canvas {
      width: 420px;
      height: 420px;
      max-width: 90%;
      max-height: 90%;
      display: block;
    }

    .panel { display: flex; flex-direction: column; gap: 14px; }

    .panel-header h1 {
      font-family: "Montserrat", system-ui, sans-serif;
      font-size: 20px;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .panel-header p {
      font-size: 13px;
      color: #6b7280;
      line-height: 1.45;
    }

    .field { margin-top: 6px; display: flex; flex-direction: column; gap: 6px; }

    .field label {
      font-size: 12px;
      font-weight: 600;
      color: #4b5563;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .field small { font-size: 11px; color: #9ca3af; }

    input[type="text"], select {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 8px 13px;
      font-size: 13px;
      outline: none;
      background-color: #ffffff;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    input[type="text"]:focus, select:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.3);
    }

    input[type="file"] { font-size: 12px; }

    .color-dots {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 2px;
    }

    .color-dot {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 2px solid #e5e7eb;
      cursor: pointer;
      position: relative;
      box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.5);
    }

    .color-dot::after {
      content: "";
      position: absolute;
      inset: 3px;
      border-radius: inherit;
      background: var(--dot-color);
    }

    .color-dot.active {
      box-shadow:
        0 0 0 1px #3b82f6,
        0 0 0 4px rgba(59, 130, 246, 0.15);
      border-color: #2563eb;
    }

    .slider-row { display: flex; align-items: center; gap: 8px; }

    input[type="range"] {
      flex: 1;
      -webkit-appearance: none;
      appearance: none;
      height: 4px;
      border-radius: 999px;
      background: #e5e7eb;
      outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: #2563eb;
      border: 2px solid #ffffff;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.6);
      cursor: pointer;
    }

    input[type="range"]::-moz-range-thumb {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: #2563eb;
      border: 2px solid #ffffff;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.6);
      cursor: pointer;
    }

    .slider-label {
      font-size: 11px;
      color: #6b7280;
      min-width: 42px;
      text-align: right;
    }

    .buttons { display: flex; gap: 10px; margin-top: 2px; }

    .btn-primary, .btn-secondary {
      flex: 1;
      border-radius: 999px;
      padding: 9px 14px;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background-color 0.12s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: #ffffff;
      box-shadow: 0 10px 18px rgba(37, 99, 235, 0.35);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 26px rgba(37, 99, 235, 0.4);
    }

    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 6px 12px rgba(37, 99, 235, 0.35);
    }

    .btn-secondary { background: #e5e7eb; color: #374151; }
    .btn-secondary:hover { background: #d1d5db; }

    .hint {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 6px;
      line-height: 1.4;
    }

    .hint b { color: #6b7280; font-weight: 600; }
    .hint a { color: #2563eb; text-decoration: none; font-weight: 500; }
    .hint a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="page">
    <div class="canvas-wrap">
      <div class="canvas-inner">
        <canvas id="dome-canvas" width="500" height="500"></canvas>
      </div>
    </div>

    <div class="panel">
      <div class="panel-header">
        <h1>Custom Design Wheel Center Cap Preview</h1>
        <p>
          Live preview to position your custom text and logo before saving the final PNG for upload on byskino.com.
          Drag the text and logo on the cap with your mouse to place them exactly where you want.
        </p>
      </div>

      <div class="field">
        <label for="text-input">Type your text</label>
        <input id="text-input" type="text" placeholder="YOUR TEXT HERE" />
      </div>

      <div class="field">
        <label for="logo-input">Upload your logo (preview only)</label>
        <input id="logo-input" type="file" accept="image/*" />
        <small>Use your final high-resolution logo. This upload is only for preview.</small>
      </div>

      <div class="field">
        <label>Background</label>
        <div class="color-dots" id="bg-dots">
          <button class="color-dot" data-color="#f9fafb" style="--dot-color:#f9fafb"></button>
          <button class="color-dot" data-color="#0f172a" style="--dot-color:#0f172a"></button>
          <button class="color-dot" data-color="#4b5563" style="--dot-color:#4b5563"></button>
          <button class="color-dot" data-color="#b91c1c" style="--dot-color:#b91c1c"></button>
          <button class="color-dot" data-color="#1d4ed8" style="--dot-color:#1d4ed8"></button>
        </div>
      </div>

      <div class="field">
        <label for="font-select">Font</label>
        <select id="font-select">
          <option value="Montserrat">Montserrat Medium</option>
          <option value="Arial">Arial</option>
          <option value="Times New Roman">Times New Roman</option>
          <option value="Roboto">Roboto</option>
        </select>
      </div>

      <div class="field">
        <label for="color-select">Text color</label>
        <select id="color-select">
          <option value="#ffffff">White</option>
          <option value="#000000">Black</option>
          <option value="#ef4444">Red</option>
          <option value="#f97316">Orange</option>
          <option value="#facc15">Yellow</option>
        </select>
      </div>

      <div class="field">
        <label>Text size</label>
        <div class="slider-row">
          <input id="text-size" type="range" min="16" max="64" value="32" />
          <span class="slider-label" id="text-size-label">32 px</span>
        </div>
      </div>

      <div class="field">
        <label>Logo zoom</label>
        <div class="slider-row">
          <input id="logo-zoom" type="range" min="60" max="260" value="140" />
          <span class="slider-label" id="logo-zoom-label">140%</span>
        </div>
      </div>

      <div class="buttons">
        <button class="btn-primary" id="save-btn">Save preview (PNG)</button>
        <button class="btn-secondary" id="reset-btn">Reset</button>
      </div>

      <p class="hint">
        <b>How to use:</b> choose a background, type your text and drag it on the cap. Upload your logo, drag it into
        position and adjust its size with <b>Logo zoom</b>. After saving, upload the PNG in the “Upload your design”
        field of the product page on <a href="https://byskino.com" target="_blank" rel="noopener">byskino.com</a>.
      </p>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("dome-canvas");
    const ctx = canvas.getContext("2d");

    const textInput = document.getElementById("text-input");
    const logoInput = document.getElementById("logo-input");
    const bgDots = document.getElementById("bg-dots");
    const fontSelect = document.getElementById("font-select");
    const colorSelect = document.getElementById("color-select");
    const textSizeRange = document.getElementById("text-size");
    const textSizeLabel = document.getElementById("text-size-label");
    const logoZoomRange = document.getElementById("logo-zoom");
    const logoZoomLabel = document.getElementById("logo-zoom-label");
    const saveBtn = document.getElementById("save-btn");
    const resetBtn = document.getElementById("reset-btn");

    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius  = 210;

    const smola = new Image();
    smola.src = "SMOLA.png";

    const state = {
      text: "",
      textX: centerX,
      textY: centerY + 150,
      textSize: 32,
      textColor: "#ffffff",
      font: "Montserrat",
      bgColor: "#0f172a",
      logoImg: null,
      logoScale: 140,
      logoX: centerX,
      logoY: centerY,
    };

    let dragTarget = null;
    let dragOffsetX = 0;
    let dragOffsetY = 0;

    function setActiveBgDot(color) {
      Array.from(bgDots.querySelectorAll(".color-dot")).forEach(dot => {
        dot.classList.toggle("active", dot.getAttribute("data-color") === color);
      });
    }

    function drawCapBackground() {
      ctx.save();
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
      ctx.closePath();
      ctx.clip();

      ctx.fillStyle = state.bgColor;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      if (smola.complete && smola.naturalWidth > 0) {
        const smolaSize = radius * 2.05;
        ctx.globalAlpha = 0.95;
        ctx.drawImage(
          smola,
          centerX - smolaSize / 2,
          centerY - smolaSize / 2,
          smolaSize,
          smolaSize
        );
        ctx.globalAlpha = 1;
      }

      ctx.restore();
    }

    function drawLogo() {
      if (!state.logoImg) return;
      const baseSize = 260; // по-голяма база
      const size = baseSize * (state.logoScale / 100);

      ctx.save();
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
      ctx.closePath();
      ctx.clip();

      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = "high";
      ctx.drawImage(
        state.logoImg,
        state.logoX - size / 2,
        state.logoY - size / 2,
        size,
        size
      );

      ctx.restore();
    }

    function drawText() {
      if (!state.text) return;

      ctx.save();
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
      ctx.closePath();
      ctx.clip();

      ctx.fillStyle = state.textColor;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.font = `${state.textSize}px ${state.font}, system-ui, sans-serif`;
      ctx.fillText(state.text, state.textX, state.textY);

      ctx.restore();
    }

    function draw() {
      drawCapBackground();
      drawLogo();
      drawText();
    }

    // === UI handlers ===
    textInput.addEventListener("input", () => {
      state.text = textInput.value;
      draw();
    });

    fontSelect.addEventListener("change", () => {
      state.font = fontSelect.value;
      draw();
    });

    colorSelect.addEventListener("change", () => {
      state.textColor = colorSelect.value;
      draw();
    });

    textSizeRange.addEventListener("input", () => {
      state.textSize = Number(textSizeRange.value);
      textSizeLabel.textContent = `${state.textSize} px`;
      draw();
    });

    logoZoomRange.addEventListener("input", () => {
      state.logoScale = Number(logoZoomRange.value);
      logoZoomLabel.textContent = `${state.logoScale}%`;
      draw();
    });

    bgDots.addEventListener("click", e => {
      const btn = e.target.closest(".color-dot");
      if (!btn) return;
      const color = btn.getAttribute("data-color");
      state.bgColor = color;
      setActiveBgDot(color);
      draw();
    });

    logoInput.addEventListener("change", e => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = ev => {
        const img = new Image();
        img.onload = () => {
          state.logoImg = img;
          state.logoX  = centerX;
          state.logoY  = centerY;
          state.logoScale = 140;
          logoZoomRange.value   = 140;
          logoZoomLabel.textContent = "140%";
          draw();
        };
        img.src = ev.target.result;
      };
      reader.readAsDataURL(file);
    });

    // === Dragging – просто и надеждно ===
    canvas.addEventListener("mousedown", e => {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      // ако няма нищо за местене – стоп
      if (!state.logoImg && !state.text) return;

      const insideCircle =
        Math.hypot(x - centerX, y - centerY) <= radius;

      if (!insideCircle) return;

      // ако има и лого, и текст:
      if (state.logoImg && state.text) {
        // горната част на кръга → мести логото
        // долната част → мести текста
        if (y < centerY + radius * 0.1) {
          dragTarget = "logo";
          dragOffsetX = x - state.logoX;
          dragOffsetY = y - state.logoY;
        } else {
          dragTarget = "text";
          dragOffsetX = x - state.textX;
          dragOffsetY = y - state.textY;
        }
      } else if (state.logoImg) {
        dragTarget = "logo";
        dragOffsetX = x - state.logoX;
        dragOffsetY = y - state.logoY;
      } else if (state.text) {
        dragTarget = "text";
        dragOffsetX = x - state.textX;
        dragOffsetY = y - state.textY;
      }
    });

    canvas.addEventListener("mousemove", e => {
      if (!dragTarget) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      if (dragTarget === "logo") {
        state.logoX = x - dragOffsetX;
        state.logoY = y - dragOffsetY;
      } else if (dragTarget === "text") {
        state.textX = x - dragOffsetX;
        state.textY = y - dragOffsetY;
      }
      draw();
    });

    window.addEventListener("mouseup", () => {
      dragTarget = null;
    });

    // === Save / Reset ===
    saveBtn.addEventListener("click", () => {
      const link = document.createElement("a");
      link.download = "custom-wheel-cap-preview.png";
      link.href = canvas.toDataURL("image/png");
      link.click();
    });

    resetBtn.addEventListener("click", () => {
      state.text = "";
      state.textX = centerX;
      state.textY = centerY + 150;
      state.textSize = 32;
      state.textColor = "#ffffff";
      state.font = "Montserrat";
      state.bgColor = "#0f172a";
      state.logoImg = null;
      state.logoScale = 140;
      state.logoX = centerX;
      state.logoY = centerY;

      textInput.value = "";
      textSizeRange.value = state.textSize;
      textSizeLabel.textContent = `${state.textSize} px`;
      logoZoomRange.value = state.logoScale;
      logoZoomLabel.textContent = `${state.logoScale}%`;
      fontSelect.value = state.font;
      colorSelect.value = state.textColor;
      logoInput.value = "";
      setActiveBgDot(state.bgColor);
      draw();
    });

    function init() {
      setActiveBgDot(state.bgColor);
      textSizeLabel.textContent = `${state.textSize} px`;
      logoZoomLabel.textContent = `${state.logoScale}%`;
      fontSelect.value = state.font;
      colorSelect.value = state.textColor;
      draw();
    }

    smola.onload = init;
    if (smola.complete && smola.naturalWidth > 0) {
      init();
    }
  </script>
</body>
</html>
