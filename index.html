<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Custom Design Wheel Center Cap Preview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Montserrat -->
  <link
    rel="preconnect"
    href="https://fonts.googleapis.com"
  />
  <link
    rel="preconnect"
    href="https://fonts.gstatic.com"
    crossorigin
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap"
    rel="stylesheet"
  />

  <style>
    * {
      box-sizing: border-box;
      -webkit-font-smoothing: antialiased;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Montserrat", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: #f2f4fb;
      color: #111827;
    }

    .page {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 40px 16px;
    }

    .card {
      width: 100%;
      max-width: 1200px;
      background: #ffffff;
      border-radius: 32px;
      box-shadow: 0 26px 60px rgba(15, 23, 42, 0.16);
      padding: 32px 32px 28px;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.1fr);
      gap: 32px;
    }

    @media (max-width: 900px) {
      .card {
        grid-template-columns: minmax(0, 1fr);
        padding: 24px 20px 22px;
      }
    }

    .title {
      font-size: 22px;
      font-weight: 800;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 13px;
      line-height: 1.5;
      color: #6b7280;
      max-width: 620px;
      margin-bottom: 20px;
    }

    .layout {
      display: contents;
    }

    .canvas-wrap {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 12px;
    }

    .canvas-inner {
      width: 100%;
      max-width: 430px;
      aspect-ratio: 1 / 1; /* пази идеален кръг */
      display: flex;
      justify-content: center;
      align-items: center;
    }

    canvas {
      /* самото съотношение се пази от width/height атрибутите */
      width: 100%;
      height: 100%;
      display: block;
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 16px;
      font-size: 13px;
    }

    label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #4b5563;
      margin-bottom: 4px;
      display: block;
    }

    input[type="text"] {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 10px 14px;
      font-size: 13px;
      outline: none;
      transition: border-color 0.16s ease, box-shadow 0.16s ease;
    }

    input[type="text"]:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.12);
    }

    .file-input {
      font-size: 12px;
    }

    .row {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .radio-row {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .swatch {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      border: 2px solid transparent;
      cursor: pointer;
      position: relative;
    }

    .swatch::after {
      content: "";
      position: absolute;
      inset: 3px;
      border-radius: inherit;
      border: 1px solid rgba(17, 24, 39, 0.15);
    }

    .swatch.active {
      border-color: #2563eb;
      box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.3);
    }

    .select {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 8px 12px;
      font-size: 13px;
      background: #f9fafb;
      outline: none;
    }

    .select:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.12);
    }

    .slider-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    input[type="range"] {
      flex: 1;
      accent-color: #2563eb;
    }

    .slider-value {
      font-size: 12px;
      color: #6b7280;
      width: 52px;
      text-align: right;
    }

    .actions {
      display: flex;
      gap: 12px;
      margin-top: 8px;
    }

    .btn {
      flex: 1;
      border-radius: 999px;
      border: none;
      padding: 11px 18px;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      cursor: pointer;
      transition: transform 0.08s ease, box-shadow 0.08s ease,
        background-color 0.16s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #2563eb, #1d4ed8);
      color: #ffffff;
      box-shadow: 0 13px 30px rgba(37, 99, 235, 0.35);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 38px rgba(37, 99, 235, 0.45);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #374151;
    }

    .btn-secondary:hover {
      background: #d1d5db;
    }

    .help {
      margin-top: 10px;
      font-size: 11px;
      line-height: 1.5;
      color: #6b7280;
    }

    .help a {
      color: #2563eb;
      text-decoration: none;
    }

    .help a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <main class="page">
    <section class="card">
      <header style="grid-column: 1 / -1;">
        <div class="title">Custom Design Wheel Center Cap Preview</div>
        <p class="subtitle">
          Live preview to position your custom text and logo before saving the
          final PNG for upload on byskino.com. Drag the text and logo on the
          cap with your mouse to place them exactly where you want.
        </p>
      </header>

      <div class="layout">
        <!-- Canvas -->
        <div class="canvas-wrap">
          <div class="canvas-inner">
            <canvas id="capCanvas" width="480" height="480"></canvas>
          </div>
        </div>

        <!-- Controls -->
        <div class="controls">
          <div class="row">
            <label for="textInput">Type your text</label>
            <input
              id="textInput"
              type="text"
              placeholder="Your text here"
              maxlength="40"
            />
          </div>

          <div class="row">
            <label for="logoInput">Upload your logo (preview only)</label>
            <input
              id="logoInput"
              class="file-input"
              type="file"
              accept="image/*"
            />
          </div>

          <div class="row">
            <label>Background</label>
            <div class="radio-row" id="bgRow">
              <button
                class="swatch active"
                data-bg="white"
                style="background:#f9fafb"
              ></button>
              <button
                class="swatch"
                data-bg="black"
                style="background:#000000"
              ></button>
              <button
                class="swatch"
                data-bg="gunmetal"
                style="background:#2b3038"
              ></button>
              <button
                class="swatch"
                data-bg="red"
                style="background:#e11d48"
              ></button>
              <button
                class="swatch"
                data-bg="blue"
                style="background:#2563eb"
              ></button>
            </div>
          </div>

          <div class="row">
            <label for="fontSelect">Font</label>
            <select id="fontSelect" class="select">
              <option value="Montserrat, sans-serif|600">
                Montserrat Medium
              </option>
              <option value="Montserrat, sans-serif|800">
                Montserrat ExtraBold
              </option>
            </select>
          </div>

          <div class="row">
            <label for="textColor">Text color</label>
            <select id="textColor" class="select">
              <option value="#000000">Black</option>
              <option value="#ffffff">White</option>
              <option value="#e11d48">Red</option>
              <option value="#2563eb">Blue</option>
            </select>
          </div>

          <div class="row">
            <label for="textSize">Text size</label>
            <div class="slider-row">
              <input
                id="textSize"
                type="range"
                min="16"
                max="140"
                value="40"
              />
              <div class="slider-value">
                <span id="textSizeValue">40</span> px
              </div>
            </div>
          </div>

          <div class="row">
            <label for="logoZoom">Logo zoom</label>
            <div class="slider-row">
              <input
                id="logoZoom"
                type="range"
                min="40"
                max="260"
                value="140"
              />
              <div class="slider-value">
                <span id="logoZoomValue">140</span> %
              </div>
            </div>
          </div>

          <div class="actions">
            <button id="saveBtn" class="btn btn-primary">
              Save preview (PNG)
            </button>
            <button id="resetBtn" class="btn btn-secondary">Reset</button>
          </div>

          <p class="help">
            How to use: choose a background, type your text and drag it on the
            cap. Upload your logo, drag it into position and adjust its size
            with <strong>Logo zoom</strong>. After saving, upload the PNG in the
            “Upload your design” field of the product page on
            <a href="https://byskino.com" target="_blank" rel="noreferrer"
              >byskino.com</a
            >.
          </p>
        </div>
      </div>
    </section>
  </main>

  <script>
    const canvas = document.getElementById("capCanvas");
    const ctx = canvas.getContext("2d");

    const textInput = document.getElementById("textInput");
    const logoInput = document.getElementById("logoInput");
    const bgRow = document.getElementById("bgRow");
    const fontSelect = document.getElementById("fontSelect");
    const textColorSelect = document.getElementById("textColor");
    const textSizeSlider = document.getElementById("textSize");
    const textSizeValue = document.getElementById("textSizeValue");
    const logoZoomSlider = document.getElementById("logoZoom");
    const logoZoomValue = document.getElementById("logoZoomValue");
    const saveBtn = document.getElementById("saveBtn");
    const resetBtn = document.getElementById("resetBtn");

    // --- state ---
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const capRadius = 175; // вътрешен цветен кръг
    const outerRadius = 215; // външен "ореол"

    let backgroundKey = "white";

    const bgColors = {
      white: "#f9fafb",
      black: "#05060a",
      gunmetal: "#2b3038",
      red: "#e11d48",
      blue: "#2563eb",
    };

    let textState = {
      text: "",
      size: 40,
      color: "#000000",
      fontFamily: "Montserrat, sans-serif",
      fontWeight: 600,
      x: centerX,
      y: centerY + 110,
    };

    const logoState = {
      image: null,
      baseSize: 260,
      zoom: 140,
      x: centerX,
      y: centerY,
    };

    const resinImage = new Image();
    resinImage.src = "SMOLA.png"; // трябва да е в същото repo
    resinImage.onload = () => {
      drawCap();
    };

    function parseFontSelect(value) {
      const [family, weight] = value.split("|");
      return {
        family: family || "Montserrat, sans-serif",
        weight: parseInt(weight || "600", 10),
      };
    }

    function drawCap() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // фон
      ctx.fillStyle = "#f3f4f6";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // мек "ореол" отвън
      const gradient = ctx.createRadialGradient(
        centerX,
        centerY,
        capRadius * 0.4,
        centerX,
        centerY,
        outerRadius
      );
      gradient.addColorStop(0, "rgba(15,23,42,0.16)");
      gradient.addColorStop(1, "rgba(15,23,42,0)");
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.arc(centerX, centerY, outerRadius, 0, Math.PI * 2);
      ctx.fill();

      // тънка тъмна рамка
      ctx.beginPath();
      ctx.arc(centerX, centerY, capRadius + 10, 0, Math.PI * 2);
      ctx.strokeStyle = "#020617";
      ctx.lineWidth = 8; // ТУК – тънък бордюр
      ctx.stroke();

      // цветен кръг
      ctx.beginPath();
      ctx.arc(centerX, centerY, capRadius, 0, Math.PI * 2);
      ctx.closePath();
      ctx.fillStyle = bgColors[backgroundKey] || bgColors.white;
      ctx.fill();

      // SMOLA купол
      if (resinImage.complete && resinImage.naturalWidth > 0) {
        ctx.save();
        ctx.beginPath();
        ctx.arc(centerX, centerY, capRadius, 0, Math.PI * 2);
        ctx.clip();
        ctx.globalAlpha = 0.98;
        ctx.drawImage(
          resinImage,
          centerX - capRadius,
          centerY - capRadius,
          capRadius * 2,
          capRadius * 2
        );
        ctx.restore();
      }

      // лого
      if (logoState.image) {
        const scale = logoState.zoom / 100;
        const drawSize = logoState.baseSize * scale;
        ctx.save();
        ctx.beginPath();
        ctx.arc(centerX, centerY, capRadius - 4, 0, Math.PI * 2);
        ctx.clip();
        ctx.drawImage(
          logoState.image,
          logoState.x - drawSize / 2,
          logoState.y - drawSize / 2,
          drawSize,
          drawSize
        );
        ctx.restore();
      }

      // текст
      if (textState.text.trim() !== "") {
        ctx.fillStyle = textState.color;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.font = `${textState.fontWeight} ${textState.size}px ${textState.fontFamily}`;
        ctx.fillText(textState.text, textState.x, textState.y);
      }
    }

    // ---- UI handlers ----

    textInput.addEventListener("input", () => {
      textState.text = textInput.value.toUpperCase();
      drawCap();
    });

    bgRow.addEventListener("click", (e) => {
      const btn = e.target.closest(".swatch");
      if (!btn) return;
      backgroundKey = btn.dataset.bg || "white";

      document
        .querySelectorAll(".swatch")
        .forEach((s) => s.classList.remove("active"));
      btn.classList.add("active");

      drawCap();
    });

    fontSelect.addEventListener("change", () => {
      const parsed = parseFontSelect(fontSelect.value);
      textState.fontFamily = parsed.family;
      textState.fontWeight = parsed.weight;
      drawCap();
    });

    textColorSelect.addEventListener("change", () => {
      textState.color = textColorSelect.value;
      drawCap();
    });

    textSizeSlider.addEventListener("input", () => {
      const size = parseInt(textSizeSlider.value, 10) || 40;
      textState.size = size;
      textSizeValue.textContent = size;
      drawCap();
    });

    logoZoomSlider.addEventListener("input", () => {
      const zoom = parseInt(logoZoomSlider.value, 10) || 140;
      logoState.zoom = zoom;
      logoZoomValue.textContent = zoom;
      drawCap();
    });

    logoInput.addEventListener("change", (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        const img = new Image();
        img.onload = () => {
          logoState.image = img;
          drawCap();
        };
        img.src = ev.target.result;
      };
      reader.readAsDataURL(file);
    });

    // ---- drag logic (text & logo) ----
    let dragging = null; // "text" | "logo" | null
    let dragOffsetX = 0;
    let dragOffsetY = 0;

    function hitTestText(x, y) {
      if (!textState.text.trim()) return false;
      ctx.font = `${textState.fontWeight} ${textState.size}px ${textState.fontFamily}`;
      const width = ctx.measureText(textState.text).width;
      const height = textState.size * 1.2;
      const left = textState.x - width / 2;
      const top = textState.y - height / 2;
      return x >= left && x <= left + width && y >= top && y <= top + height;
    }

    function hitTestLogo(x, y) {
      if (!logoState.image) return false;
      const scale = logoState.zoom / 100;
      const size = logoState.baseSize * scale;
      const left = logoState.x - size / 2;
      const top = logoState.y - size / 2;
      return x >= left && x <= left + size && y >= top && y <= top + size;
    }

    function canvasPointFromEvent(evt) {
      const rect = canvas.getBoundingClientRect();
      const clientX = evt.touches ? evt.touches[0].clientX : evt.clientX;
      const clientY = evt.touches ? evt.touches[0].clientY : evt.clientY;
      const x = ((clientX - rect.left) / rect.width) * canvas.width;
      const y = ((clientY - rect.top) / rect.height) * canvas.height;
      return { x, y };
    }

    function onPointerDown(evt) {
      evt.preventDefault();
      const { x, y } = canvasPointFromEvent(evt);

      if (hitTestLogo(x, y)) {
        dragging = "logo";
        dragOffsetX = x - logoState.x;
        dragOffsetY = y - logoState.y;
      } else if (hitTestText(x, y)) {
        dragging = "text";
        dragOffsetX = x - textState.x;
        dragOffsetY = y - textState.y;
      } else {
        dragging = null;
        return;
      }
    }

    function onPointerMove(evt) {
      if (!dragging) return;
      evt.preventDefault();
      const { x, y } = canvasPointFromEvent(evt);

      if (dragging === "logo") {
        logoState.x = x - dragOffsetX;
        logoState.y = y - dragOffsetY;
      } else if (dragging === "text") {
        textState.x = x - dragOffsetX;
        textState.y = y - dragOffsetY;
      }
      drawCap();
    }

    function onPointerUp() {
      dragging = null;
    }

    canvas.addEventListener("mousedown", onPointerDown);
    window.addEventListener("mousemove", onPointerMove);
    window.addEventListener("mouseup", onPointerUp);

    canvas.addEventListener("touchstart", onPointerDown, { passive: false });
    window.addEventListener("touchmove", onPointerMove, { passive: false });
    window.addEventListener("touchend", onPointerUp);
    window.addEventListener("touchcancel", onPointerUp);

    // ---- save / reset ----
    saveBtn.addEventListener("click", () => {
      const link = document.createElement("a");
      link.download = "byskino-custom-cap.png";
      link.href = canvas.toDataURL("image/png");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

    resetBtn.addEventListener("click", () => {
      textInput.value = "";
      textState.text = "";
      textState.size = 40;
      textSizeSlider.value = 40;
      textSizeValue.textContent = "40";
      textState.color = "#000000";
      textColorSelect.value = "#000000";

      const parsed = parseFontSelect(fontSelect.value);
      textState.fontFamily = parsed.family;
      textState.fontWeight = parsed.weight;

      textState.x = centerX;
      textState.y = centerY + 110;

      logoInput.value = "";
      logoState.image = null;
      logoState.zoom = 140;
      logoZoomSlider.value = 140;
      logoZoomValue.textContent = "140";
      logoState.x = centerX;
      logoState.y = centerY;

      backgroundKey = "white";
      document
        .querySelectorAll(".swatch")
        .forEach((s) => s.classList.remove("active"));
      document
        .querySelector('.swatch[data-bg="white"]')
        .classList.add("active");

      drawCap();
    });

    // initial draw
    (function init() {
      textInput.value = "";
      const parsed = parseFontSelect(fontSelect.value);
      textState.fontFamily = parsed.family;
      textState.fontWeight = parsed.weight;
      textSizeValue.textContent = textState.size;
      logoZoomValue.textContent = logoState.zoom;
      drawCap();
    })();
  </script>
</body>
</html>
