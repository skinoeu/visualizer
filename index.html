<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Custom Design Wheel Center Cap Preview</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f3f5fa;
        margin: 0;
        padding: 0;
    }

    .container {
        width: 100%;
        display: flex;
        justify-content: center;
        padding-top: 50px;
    }

    .wrapper {
        background: white;
        padding: 40px;
        border-radius: 15px;
        width: 1100px;
        display: flex;
        gap: 40px;
        box-shadow: 0 0 25px rgba(0,0,0,0.08);
    }

    /* CANVAS AREA */
    .preview-area {
        width: 520px;
        height: 520px;
        position: relative;
        user-select: none;
    }

    #capCanvas {
        width: 520px;
        height: 520px;
        border-radius: 50%;
    }

    /* RIGHT PANEL */
    .controls {
        flex: 1;
    }

    input[type="range"] {
        width: 100%;
    }

    /* Background color selector */
    .color-dot {
        width: 18px;
        height: 18px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
        border: 1px solid #ccc;
        cursor: pointer;
    }

</style>
</head>
<body>

<div class="container">
    <div class="wrapper">

        <!-- LEFT SIDE — PREVIEW -->
        <div class="preview-area">
            <canvas id="capCanvas" width="800" height="800"></canvas>
        </div>

        <!-- RIGHT SIDE — CONTROLS -->
        <div class="controls">

            <h2>Custom Design Wheel Center Cap Preview</h2>

            <label>Type your text</label><br>
            <input type="text" id="userText" style="width:100%;" value="BLACK EDITION"><br><br>

            <label>Upload your logo (preview only)</label><br>
            <input type="file" id="uploadLogo"><br><br>

            <label>Background</label><br>
            <span class="color-dot" style="background:#ffffff" onclick="setBg('#ffffff')"></span>
            <span class="color-dot" style="background:#000000" onclick="setBg('#000000')"></span>
            <span class="color-dot" style="background:#555555" onclick="setBg('#555555')"></span>
            <span class="color-dot" style="background:#cc0000" onclick="setBg('#cc0000')"></span>
            <span class="color-dot" style="background:#0047ff" onclick="setBg('#0047ff')"></span>
            <br><br>

            <label>Font</label><br>
            <select id="fontSelect" style="width:100%;">
                <option value="Montserrat">Montserrat Medium</option>
                <option value="Arial">Arial</option>
                <option value="Georgia">Georgia</option>
            </select><br><br>

            <label>Text color</label><br>
            <select id="textColor" style="width:100%;">
                <option value="white">White</option>
                <option value="black">Black</option>
            </select><br><br>

            <label>Text size</label><br>
            <input type="range" id="textSize" min="16" max="80" value="38"><br><br>

            <label>Logo zoom</label><br>
            <input type="range" id="logoZoom" min="20" max="200" value="100"><br><br>

            <button onclick="savePNG()" style="padding:10px 25px; background:#0b6cf0; color:white; border:none; border-radius:8px;">Save preview (PNG)</button>
            <button onclick="resetAll()" style="padding:10px 25px; background:#ddd; border:none; border-radius:8px;">Reset</button>

            <p style="margin-top:20px; font-size:13px; opacity:0.6;">
                Drag your text and logo with the mouse to position them anywhere on the cap.
                After saving, upload the PNG in the “Upload your design” field of the product page on byskino.com.
            </p>

        </div>

    </div>
</div>

<script>
/* CANVAS + INTERACTION */
const canvas = document.getElementById("capCanvas");
const ctx = canvas.getContext("2d");

let bgColor = "#ffffff";
let domeImage = new Image();
domeImage.src = "SMOLA.png";

let userLogo = null;
let userText = "BLACK EDITION";
let textX = 400, textY = 650;
let logoX = 400, logoY = 400;
let draggingText = false;
let draggingLogo = false;

document.getElementById("userText").addEventListener("input", e => {
    userText = e.target.value;
    draw();
});

document.getElementById("fontSelect").addEventListener("change", draw);
document.getElementById("textColor").addEventListener("change", draw);
document.getElementById("textSize").addEventListener("input", draw);
document.getElementById("logoZoom").addEventListener("input", draw);

function setBg(color) {
    bgColor = color;
    draw();
}

document.getElementById("uploadLogo").addEventListener("change", e => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(event) {
        userLogo = new Image();
        userLogo.onload = draw;
        userLogo.src = event.target.result;
    };
    reader.readAsDataURL(file);
});

/* MOUSE DRAGGING */
canvas.addEventListener('mousedown', function(e) {
    const mx = e.offsetX, my = e.offsetY;

    // Drag text
    ctx.font = getTextSize()+"px " + document.getElementById("fontSelect").value;
    let textWidth = ctx.measureText(userText).width;
    if (mx > textX - textWidth/2 && mx < textX + textWidth/2 && my > textY - 40 && my < textY + 10) {
        draggingText = true;
        return;
    }

    // Drag logo
    if (userLogo) {
        let size = getLogoSize();
        if (mx > logoX - size/2 && mx < logoX + size/2 && my > logoY - size/2 && my < logoY + size/2) {
            draggingLogo = true;
            return;
        }
    }
});

canvas.addEventListener('mousemove', function(e) {
    if (draggingText) { textX = e.offsetX; textY = e.offsetY; draw(); }
    if (draggingLogo) { logoX = e.offsetX; logoY = e.offsetY; draw(); }
});

canvas.addEventListener('mouseup', () => { draggingText = draggingLogo = false; });


function getTextSize() {
    return document.getElementById("textSize").value;
}

function getLogoSize() {
    return document.getElementById("logoZoom").value * 3;
}

/* MAIN DRAW FUNCTION */
function draw() {
    ctx.clearRect(0,0,800,800);

    // Background circle
    ctx.beginPath();
    ctx.arc(400,400,330,0,Math.PI*2);
    ctx.fillStyle = bgColor;
    ctx.fill();

    // Logo
    if (userLogo) {
        let size = getLogoSize();
        ctx.drawImage(userLogo, logoX - size/2, logoY - size/2, size, size);
    }

    // Text
    ctx.fillStyle = document.getElementById("textColor").value;
    ctx.font = getTextSize()+"px " + document.getElementById("fontSelect").value;
    ctx.textAlign = "center";
    ctx.fillText(userText, textX, textY);

    // Dome
    ctx.drawImage(domeImage, 0, 0, 800, 800);
}

/* SAVE PNG */
function savePNG() {
    const link = document.createElement('a');
    link.download = "custom-design.png";
    link.href = canvas.toDataURL();
    link.click();
}

/* RESET */
function resetAll() {
    textX = 400; textY = 650;
    logoX = 400; logoY = 400;
    userLogo = null;
    document.getElementById("uploadLogo").value = "";
    draw();
}

domeImage.onload = draw;

</script>

</body>
</html>
