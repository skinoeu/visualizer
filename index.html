<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Custom Design Wheel Center Cap Preview</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      -webkit-font-smoothing: antialiased;
    }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f5fb;
      color: #222;
    }
    .page {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px 16px;
    }
    .card {
      max-width: 1200px;
      width: 100%;
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 24px 60px rgba(15, 23, 42, 0.16);
      display: flex;
      gap: 32px;
      padding: 32px 40px;
    }
    @media (max-width: 960px) {
      .card {
        flex-direction: column;
        align-items: center;
        padding: 24px 20px;
      }
    }
    .left {
      flex: 0 0 480px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .right {
      flex: 1;
      max-width: 520px;
    }
    h1 {
      font-size: 22px;
      margin: 0 0 4px;
    }
    .subtitle {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 18px;
    }
    canvas {
      display: block;
      width: 420px;
      height: 420px;
    }
    .field {
      margin-bottom: 14px;
      font-size: 13px;
    }
    .field label {
      display: block;
      margin-bottom: 4px;
      font-weight: 500;
    }
    input[type="text"],
    select {
      width: 100%;
      padding: 7px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 13px;
    }
    input[type="file"] {
      font-size: 12px;
    }
    .bg-swatches {
      display: flex;
      gap: 8px;
      margin-top: 4px;
    }
    .swatch {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 2px solid transparent;
      cursor: pointer;
    }
    .swatch.active {
      border-color: #2563eb;
    }
    .slider-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .slider-row span {
      font-size: 11px;
      color: #6b7280;
      white-space: nowrap;
    }
    input[type="range"] {
      flex: 1;
    }
    .buttons {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }
    .btn {
      border-radius: 999px;
      border: none;
      font-size: 13px;
      padding: 8px 18px;
      cursor: pointer;
    }
    .btn-primary {
      background: #2563eb;
      color: #fff;
    }
    .btn-ghost {
      background: #e5e7eb;
      color: #111827;
    }
    .hint {
      margin-top: 12px;
      font-size: 11px;
      color: #6b7280;
      line-height: 1.4;
    }
  </style>
</head>
<body>
<div class="page">
  <div class="card">
    <div class="left">
      <canvas id="dome-canvas" width="480" height="480"></canvas>
    </div>

    <div class="right">
      <h1>Custom Design Wheel Center Cap Preview</h1>
      <div class="subtitle">
        Live preview to position your custom text and logo before saving the final PNG for upload on byskino.com.
      </div>

      <div class="field">
        <label for="text-input">Type your text</label>
        <input id="text-input" type="text" value="BLACK EDITION" />
      </div>

      <div class="field">
        <label for="logo-upload">Upload your logo (preview only)</label>
        <input id="logo-upload" type="file" accept="image/*" />
      </div>

      <div class="field">
        <label>Background</label>
        <div class="bg-swatches" id="bg-swatches">
          <div class="swatch active" data-color="#ffffff" style="background:#ffffff;"></div>
          <div class="swatch" data-color="#111111" style="background:#111111;"></div>
          <div class="swatch" data-color="#4b5563" style="background:#4b5563;"></div>
          <div class="swatch" data-color="#991b1b" style="background:#991b1b;"></div>
          <div class="swatch" data-color="#1d4ed8" style="background:#1d4ed8;"></div>
        </div>
      </div>

      <div class="field">
        <label for="font-select">Font</label>
        <select id="font-select">
          <option value="Montserrat Medium">Montserrat Medium</option>
          <option value="Montserrat SemiBold">Montserrat SemiBold</option>
          <option value="Helvetica Neue">Helvetica Neue</option>
          <option value="Arial">Arial</option>
        </select>
      </div>

      <div class="field">
        <label for="color-select">Text color</label>
        <select id="color-select">
          <option value="#ffffff">White</option>
          <option value="#000000">Black</option>
          <option value="#f97316">Orange</option>
          <option value="#facc15">Yellow</option>
          <option value="#a855f7">Purple</option>
        </select>
      </div>

      <div class="field">
        <label>Text size</label>
        <div class="slider-row">
          <input id="text-size" type="range" min="18" max="60" value="34" />
          <span id="text-size-label">34 px</span>
        </div>
      </div>

      <div class="field">
        <label>Logo zoom</label>
        <div class="slider-row">
          <input id="logo-zoom" type="range" min="40" max="160" value="100" />
          <span id="logo-zoom-label">100%</span>
        </div>
      </div>

      <div class="buttons">
        <button class="btn btn-primary" id="save-btn">Save preview (PNG)</button>
        <button class="btn btn-ghost" id="reset-btn">Reset</button>
      </div>

      <div class="hint">
        Drag your text and logo with the mouse to position them anywhere on the cap.  
        After saving, upload the PNG in the “Upload your design” field of the product page on byskino.com.
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const canvas = document.getElementById("dome-canvas");
    const ctx = canvas.getContext("2d");

    const textInput = document.getElementById("text-input");
    const logoUpload = document.getElementById("logo-upload");
    const bgSwatches = document.getElementById("bg-swatches");
    const fontSelect = document.getElementById("font-select");
    const colorSelect = document.getElementById("color-select");
    const textSizeSlider = document.getElementById("text-size");
    const textSizeLabel = document.getElementById("text-size-label");
    const logoZoomSlider = document.getElementById("logo-zoom");
    const logoZoomLabel = document.getElementById("logo-zoom-label");
    const saveBtn = document.getElementById("save-btn");
    const resetBtn = document.getElementById("reset-btn");

    // --- STATE ---
    const state = {
      bgColor: "#ffffff",
      text: textInput.value,
      fontFamily: fontSelect.value,
      textColor: colorSelect.value,
      textSize: parseInt(textSizeSlider.value, 10),
      textX: canvas.width / 2,
      textY: canvas.height * 0.80,
      logoImg: null,
      logoScale: parseInt(logoZoomSlider.value, 10) / 100,
      logoX: canvas.width / 2,
      logoY: canvas.height / 2,
      dragging: null,
      dragOffsetX: 0,
      dragOffsetY: 0
    };

    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const radius = 180;

    // SMOLA (resin) overlay
    const domeOverlay = new Image();
    domeOverlay.src = "SMOLA.png";

    // --- HELPERS ---
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // soft shadow
      ctx.save();
      ctx.translate(centerX, centerY + 14);
      const shadowGrad = ctx.createRadialGradient(0, 0, radius * 0.6, 0, 0, radius * 1.1);
      shadowGrad.addColorStop(0, "rgba(15,23,42,0.40)");
      shadowGrad.addColorStop(1, "rgba(15,23,42,0)");
      ctx.fillStyle = shadowGrad;
      ctx.beginPath();
      ctx.ellipse(0, 0, radius * 1.05, radius * 1.05 * 0.55, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();

      // main background circle
      ctx.save();
      ctx.translate(centerX, centerY);
      ctx.beginPath();
      ctx.arc(0, 0, radius, 0, Math.PI * 2);
      ctx.fillStyle = state.bgColor;
      ctx.fill();
      ctx.restore();

      // SMOLA overlay (draw full size over the circle)
      if (domeOverlay.complete) {
        ctx.save();
        const size = radius * 2;
        ctx.drawImage(
          domeOverlay,
          centerX - radius,
          centerY - radius,
          size,
          size
        );
        ctx.restore();
      }

      // LOGO
      if (state.logoImg) {
        const baseSize = 150;
        const size = baseSize * state.logoScale;
        ctx.save();
        ctx.beginPath();
        ctx.arc(state.logoX, state.logoY, size / 2, 0, Math.PI * 2);
        ctx.clip();
        ctx.drawImage(
          state.logoImg,
          state.logoX - size / 2,
          state.logoY - size / 2,
          size,
          size
        );
        ctx.restore();
      }

      // TEXT
      ctx.save();
      ctx.font = state.textSize + "px \"" + state.fontFamily + "\", Arial, sans-serif";
      ctx.fillStyle = state.textColor;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";

      // subtle stroke за читимост върху тъмно
      ctx.lineWidth = 3;
      ctx.strokeStyle = "rgba(0,0,0,0.55)";
      ctx.strokeText(state.text, state.textX, state.textY);

      ctx.fillText(state.text, state.textX, state.textY);
      ctx.restore();
    }

    function resetState() {
      state.bgColor = "#ffffff";
      state.text = "BLACK EDITION";
      state.fontFamily = "Montserrat Medium";
      state.textColor = "#ffffff";
      state.textSize = 34;
      state.textX = centerX;
      state.textY = canvas.height * 0.80;
      state.logoImg = null;
      state.logoScale = 1.0;
      state.logoX = centerX;
      state.logoY = centerY;
      state.dragging = null;

      // reset UI
      textInput.value = state.text;
      fontSelect.value = state.fontFamily;
      colorSelect.value = state.textColor;
      textSizeSlider.value = state.textSize;
      textSizeLabel.textContent = state.textSize + " px";
      logoZoomSlider.value = 100;
      logoZoomLabel.textContent = "100%";

      Array.from(bgSwatches.children).forEach((el, i) => {
        el.classList.toggle("active", i === 0);
      });

      draw();
    }

    // --- EVENTS ---

    textInput.addEventListener("input", () => {
      state.text = textInput.value || "";
      draw();
    });

    fontSelect.addEventListener("change", () => {
      state.fontFamily = fontSelect.value;
      draw();
    });

    colorSelect.addEventListener("change", () => {
      state.textColor = colorSelect.value;
      draw();
    });

    textSizeSlider.addEventListener("input", () => {
      state.textSize = parseInt(textSizeSlider.value, 10);
      textSizeLabel.textContent = state.textSize + " px";
      draw();
    });

    logoZoomSlider.addEventListener("input", () => {
      state.logoScale = parseInt(logoZoomSlider.value, 10) / 100;
      logoZoomLabel.textContent = logoZoomSlider.value + "%";
      draw();
    });

    bgSwatches.addEventListener("click", (e) => {
      const target = e.target.closest(".swatch");
      if (!target) return;
      const color = target.dataset.color;
      if (!color) return;
      state.bgColor = color;
      Array.from(bgSwatches.children).forEach((el) => {
        el.classList.toggle("active", el === target);
      });
      draw();
    });

    logoUpload.addEventListener("change", (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        const img = new Image();
        img.onload = () => {
          state.logoImg = img;
          state.logoX = centerX;
          state.logoY = centerY;
          draw();
        };
        img.src = ev.target.result;
      };
      reader.readAsDataURL(file);
    });

    // dragging text / logo
    function getMousePos(evt) {
      const rect = canvas.getBoundingClientRect();
      return {
        x: (evt.clientX - rect.left) * (canvas.width / rect.width),
        y: (evt.clientY - rect.top) * (canvas.height / rect.height)
      };
    }

    canvas.addEventListener("mousedown", (evt) => {
      const { x, y } = getMousePos(evt);

      // check logo hit
      if (state.logoImg) {
        const baseSize = 150;
        const size = baseSize * state.logoScale;
        const dx = x - state.logoX;
        const dy = y - state.logoY;
        if (Math.sqrt(dx * dx + dy * dy) <= size / 2) {
          state.dragging = "logo";
          state.dragOffsetX = x - state.logoX;
          state.dragOffsetY = y - state.logoY;
          return;
        }
      }

      // check text hit
      ctx.save();
      ctx.font = state.textSize + "px \"" + state.fontFamily + "\", Arial, sans-serif";
      const metrics = ctx.measureText(state.text || " ");
      ctx.restore();
      const textWidth = metrics.width;
      const textHeight = state.textSize * 1.2;
      const left = state.textX - textWidth / 2;
      const right = state.textX + textWidth / 2;
      const top = state.textY - textHeight / 2;
      const bottom = state.textY + textHeight / 2;
      if (x >= left && x <= right && y >= top && y <= bottom) {
        state.dragging = "text";
        state.dragOffsetX = x - state.textX;
        state.dragOffsetY = y - state.textY;
        return;
      }
    });

    canvas.addEventListener("mousemove", (evt) => {
      if (!state.dragging) return;
      const { x, y } = getMousePos(evt);
      if (state.dragging === "logo") {
        state.logoX = x - state.dragOffsetX;
        state.logoY = y - state.dragOffsetY;
      } else if (state.dragging === "text") {
        state.textX = x - state.dragOffsetX;
        state.textY = y - state.dragOffsetY;
      }
      draw();
    });

    canvas.addEventListener("mouseup", () => {
      state.dragging = null;
    });
    canvas.addEventListener("mouseleave", () => {
      state.dragging = null;
    });

    saveBtn.addEventListener("click", () => {
      const link = document.createElement("a");
      link.href = canvas.toDataURL("image/png");
      link.download = "custom-dome-preview.png";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });

    resetBtn.addEventListener("click", () => {
      resetState();
      logoUpload.value = "";
    });

    // initial draw
    domeOverlay.onload = () => {
      resetState();
    };
    if (domeOverlay.complete) {
      resetState();
    }
  });
</script>
</body>
</html>
